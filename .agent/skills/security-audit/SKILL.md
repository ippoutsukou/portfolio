---
name: security-audit
description: 公開（誰でも閲覧可能）を前提に、静的サイト（GitHub Pages等）のリポジトリをセキュリティ観点で監査する。秘密情報漏えい、不必要な公開物、XSS/危険DOM操作、外部CDN依存のリスクを点検し、再現可能な手順と修正TODOを提示する時に使う。
---

# Skill: security-audit
公開（誰でも閲覧可能）を前提に、静的サイト（GitHub Pages等）のリポジトリをセキュリティ観点で監査する。

## ゴール（アウトカム）
- 公開NG情報（秘密情報・個人情報・社内情報・顧客情報）を検出し除去する
- 不要公開物（バックアップ・ログ・一時ファイル等）を除去する
- フロントの典型的リスク（XSS/危険API/外部CDN改ざん耐性）を洗い出し、修正案を提示する
- 監査結果を「再現可能な手順＋修正TODO」として残す

## 入力
- リポジトリ全体（HTML/CSS/JS/Markdown/画像/設定ファイル）

## 出力フォーマット（必須）
以下のセクション構成で報告すること。

1. **監査サマリ**
   - 高: 致命的（公開停止/即修正）
   - 中: 重要（公開前に修正推奨）
   - 低: 改善（任意）

2. **検出結果一覧（テーブル）**
   - Severity | Category | File | Evidence（該当箇所） | Risk | Fix（具体案）

3. **修正パッチ案**
   - 可能なら差分（before/after）で提示

4. **公開前チェックの最終確認（チェックボックス）**
   - ✅ Secretsなし
   - ✅ 不要ファイルなし
   - ✅ 危険DOM操作なし/対処済
   - ✅ 外部CDNの採用理由/バージョン固定/代替が明記
   - ✅ 公開対象（content等）の棚卸し完了

## 監査手順（順番固定）

### Step 1: 公開NG情報（Secrets/PII/社内情報）の検出（最優先）
**探すもの**
- APIキー / トークン / パスワード / Basic認証情報
- OAuth/Client Secret
- Cookie, Session, JWT
- 個人情報（氏名・住所・電話・メール）
- 社内URL（イントラ、社内ツール、社内IP、VPN前提リンク）
- 顧客名・案件名（公開不可の可能性がある）

**ヒント（典型パターン）**
- `.env`, `config.*`, `settings.*`, `credentials.*`, `secrets.*`
- 文字列: `apiKey`, `token`, `secret`, `password`, `Authorization`, `Bearer`, `AKIA`, `-----BEGIN`

**出力**
- 具体的なファイルパスと該当箇所（行/周辺）を示すこと
- 「公開可/不可」の判定と根拠
- 対処：削除/マスキング/移設/履歴除去の注意喚起

### Step 2: 不要公開物の棚卸し（公開面の最小化）
**探すもの**
- バックアップ: `*.bak`, `*.old`, `*~`
- 圧縮: `*.zip`, `*.7z`, `*.rar`
- 一時: `tmp/`, `temp/`, `draft/`, `backup/`, `dist-old/`
- ログ/出力: `*.log`, `debug.txt`, `output/`
- 大容量/重複（公開意図がないもの）

**出力**
- 削除候補と理由（公開不要・漏えいリスク・容量）

### Step 3: 外部依存（CDN/3rd party）のリスク整理
**やること**
- HTML内の外部 `script/link` を一覧化（ドメイン・目的・URL・バージョン）
- バージョン固定がないものを指摘
- SRI適用可能性をコメント
- ローカル同梱案（vendor化）や代替手段を提示

**出力**
- 「この依存を採用する理由」を短く書ける形で提案（運用メモ用）

### Step 4: XSS/危険DOM操作の検出（静的でも重要）
**探すもの（危険API）**
- `innerHTML`, `outerHTML`, `insertAdjacentHTML`
- `eval`, `new Function`, `setTimeout("...")`
- URL由来: `location.search`, `location.hash`, `document.URL`
- 外部データ（JSON/MD）をHTMLとして描画する処理

**判断基準**
- ユーザー入力/URL/外部データをそのままHTMLとして挿入していれば「高」
- 固定文字列のみなら「低」だが、将来変更の注意を残す

**修正方針**
- 可能なら `textContent` / DOM生成APIへ置き換え
- どうしてもHTMLが必要ならサニタイズ（ただし依存追加は慎重に）

### Step 5: 公開設計の確認（静的ホスティング特有）
**確認すること**
- `content/` 配下に “見せたくない生データ” がないか
- `.md` のまま公開してよいか（生表示/ダウンロードになりやすい）
- 日本語パス/ファイル名がある場合、ホスティング環境で問題が出ないか（URLエンコード等）

**出力**
- 公開体験（閲覧性）と安全性（出し分け不可）を踏まえた提案

## 重大度の定義（必須）
- **高（Critical）**：秘密情報/個人情報/社内情報の露出、フロントにAPIキー、明確なXSS成立、公開不要だが機密性が高いファイル
- **中（High）**：外部CDNのバージョン未固定、危険APIの使用（現状は固定データだが将来危険）、公開物過多
- **低（Medium/Low）**：改善提案（保守性/可用性/表示品質）

## 監査レポートのテンプレ（コピペ用）
### 1. 監査サマリ
- 高: X件
- 中: X件
- 低: X件

### 2. 検出結果一覧
| Severity | Category | File | Evidence | Risk | Fix |
|---|---|---|---|---|---|

### 3. 修正パッチ案
- 対象: `path/to/file`
- before:
- after:

### 4. 公開前チェック（最終）
- [ ] Secretsなし
- [ ] 不要ファイルなし
- [ ] 危険DOM操作なし/対処済
- [ ] 外部CDN整理済（理由/固定/代替）
- [ ] 公開対象の棚卸し完了
