
# 事業別損益 可視化（配賦ルール切替）

ローカルで動く Streamlit アプリです。DB 不要、Excel ファイルを読み込み、**人件費を「売上高比率」または「従業員工数配賦」**で配賦し、事業別損益を可視化します。

## 使い方

1. Python 3.10+ を用意し、依存関係をインストール
   ```bash
   pip install -r requirements.txt
   ```

2. アプリを起動
   ```bash
   streamlit run app.py
   ```

3. 画面左のサイドバーで Excel を指定（同梱の `/mnt/data/` 上のファイルは自動で読み込み候補になります）  
   列名が異なる場合は「列マッピング」で対応させてください。

## 期待する主な列

- 損益データ（例: 業種別損益データ_2025-04_2026-03.1.xlsx）
  - 事業/業種/セグメントの列
  - 日付/年月 列（自動で YYYY-MM に正規化）
  - 売上, 売上原価, 人件費（配賦対象）, 販管費その他（任意）

- 工数データ（例: 従業員工数配賦データ.xlsx）
  - 事業 列
  - 工数/時間 列
  - ※期間列がない場合、本アプリでは全期間に同一比率で配賦します。

## 画面

- **Dashboard**: 事業別の売上・粗利・営業利益（棒グラフ）、四象限マップ（売上 × 利益率）
- **配賦ルール設定（プレビュー）**: 事業×期間の配賦率および配賦後人件費の一覧、売上比/工数比の簡易比較表
- **事業別詳細**: 損益分岐点の参考グラフ、コスト構成（円）、時系列推移

## カスタマイズ

- 工数データに期間列がある場合、期間一致での配賦にも拡張可能です。
- 配賦対象科目を増やす、複数シナリオ保存、権限管理なども追加可能です。
